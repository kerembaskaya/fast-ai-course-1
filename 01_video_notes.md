# Step 1: Download images of birds and non-birds


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from duckduckgo_search import DDGS
from fastcore.all import * 
import time, json
def search_images(keywords, max_images=200): return L(DDGS().images(keywords, max_results=max_images)).itemgot('image')
```

``` python
urls = search_images('bird photos', max_images=1)
```

``` python
urls[0]
```

    'https://images.pexels.com/photos/326900/pexels-photo-326900.jpeg?cs=srgb&dl=wood-flight-bird-326900.jpg&fm=jpg'

``` python
from fastdownload import download_url
dest = 'resources/L1/bird.jpg'
download_url(urls[0], dest, show_progress=False)

from fastai.vision.all import *
im = Image.open(dest)
im.to_thumb(256,256)
```

![](01_video_notes_files/figure-commonmark/cell-5-output-1.png)

``` python
forest_dest = 'resources/L1/forest.jpg'
download_url(search_images('forest photos', max_images=1)[0], forest_dest, show_progress=False)
Image.open(forest_dest).to_thumb(256, 256)
```

![](01_video_notes_files/figure-commonmark/cell-6-output-1.png)

``` python
searches = 'forest', 'bird'
path = Path('resources/L1/bird_or_not')

for o in searches:
    dest = (path/o)
    dest.mkdir(exist_ok=True, parents=True)
    download_images(dest, urls=search_images(f'{o} photo'))
    time.sleep(5)
    resize_images(path/o, max_size=400, dest=path/o)
```

## Step 2: Train our model

``` python
failed = verify_images(get_image_files(path))
failed.map(Path.unlink)
len(failed)
```

    9

``` python
failed
```

    (#9) [Path('resources/L1/bird_or_not/forest/abd784a1-3a25-44ef-bdc1-80b6534cf595.jpg'),Path('resources/L1/bird_or_not/forest/fe60f645-6e9b-430b-adb3-e2b0fcf88a69.jpg'),Path('resources/L1/bird_or_not/forest/181caa2c-e35c-4944-afef-93f8041cba69.jpg'),Path('resources/L1/bird_or_not/forest/e3f5bf43-1e42-441c-9b41-9071b5498155.jpg'),Path('resources/L1/bird_or_not/bird/635ac5ea-6cb9-4789-8701-27df1f14b07c.png'),Path('resources/L1/bird_or_not/bird/33f184ad-e975-4923-b596-788f92dd50e2.jpg'),Path('resources/L1/bird_or_not/bird/0ec2bdec-71a3-44c4-baae-0140fd524502.jpg'),Path('resources/L1/bird_or_not/bird/618e54b8-5c9d-46af-9fa6-33d7c6c8bf4e.jpg'),Path('resources/L1/bird_or_not/bird/0ae76c90-5071-45e2-8714-a11079008bac.jpg')]

``` python
dls = DataBlock(
    blocks=(ImageBlock, CategoryBlock),
    get_items=get_image_files,
    splitter=RandomSplitter(valid_pct=0.2, seed=42),
    get_y=parent_label, 
    item_tfms=[Resize(192, method='squish')]).dataloaders(path, bs=32)

dls.show_batch(max_n=6)
```

![](01_video_notes_files/figure-commonmark/cell-10-output-1.png)

``` python
learn = vision_learner(dls, resnet18, metrics=error_rate)
learn.fine_tune(3)
```

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: left;">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.165263</td>
<td>0.029461</td>
<td>0.003247</td>
<td>00:05</td>
</tr>
</tbody>
</table>

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: left;">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.019386</td>
<td>0.000162</td>
<td>0.000000</td>
<td>00:07</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.021068</td>
<td>0.000943</td>
<td>0.000000</td>
<td>00:06</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.016560</td>
<td>0.000037</td>
<td>0.000000</td>
<td>00:07</td>
</tr>
</tbody>
</table>

## Step 3: Use our model

``` python
is_bird,_,probs = learn.predict(PILImage.create('resources/L1/bird.jpg'))
print(f"This is a: {is_bird}.")
print(f"Probability it's a bird: {probs[0]:.4f}")
```

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

    This is a: bird.
    Probability it's a bird: 1.0000
